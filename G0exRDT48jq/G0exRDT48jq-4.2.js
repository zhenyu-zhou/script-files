/*!CK:4178936313!*//*1427933498,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["fhG9w"]); }

__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads"};},null);
__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){e.exports={CONTAIN:"s",COVER:"p"};},null);
__d("SplitImage.react",["React","Image.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=g.createClass({displayName:"SplitImage",render:function(){var l=this.props.size;return (g.createElement("div",g.__spread({},this.props,{className:j(this.props.className,"_55lt"),style:Object.assign({},(this.props.style||{}),{width:l,height:l})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var l=this.props.srcs,m=Array.isArray(l);if(!m||l.length==1)return this.renderOne(m?l[0]:l);return l.length==2?this.renderTwo(l):this.renderThree(l);},renderOne:function(l){return (g.createElement(h,{src:l,width:this.props.size,height:this.props.size,alt:""}));},renderTwo:function(l){var m=this.props.size,n=Math.floor(m/2),o=-Math.floor(n/2),p=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.createElement("div",null,g.createElement("div",{className:"_55lu",style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:p,style:{width:n}},g.createElement(h,{src:l[1],width:m,height:m,style:{marginLeft:o}}))));},renderThree:function(l){var m=this.props.size,n=Math.floor(m/3*2),o=-Math.floor((m-n)/2),p=Math.floor(m/2),q=m-n,r=-Math.floor((p-q)/2),s=(("_55lu")+(this.props.border?' '+"_57pl":'')),t=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.createElement("div",null,g.createElement("div",{className:s,style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:t,style:{width:q,height:p}},g.createElement(h,{src:l[1],width:p,height:p,style:{marginLeft:r}})),g.createElement("div",{className:"_55lu",style:{width:q,height:p}},g.createElement(h,{src:l[2],width:p,height:p,style:{marginLeft:r}}))));}});e.exports=k;},null);
__d("RangedCallbackManager",["CallbackManagerController","createObjectFrom"],function(a,b,c,d,e,f,g,h){function i(j,k,l){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager1=false;this.$RangedCallbackManager2=false;this.$RangedCallbackManager3={};this.$RangedCallbackManager4=new g(this.$RangedCallbackManager5.bind(this));this.$RangedCallbackManager6=j;this.$RangedCallbackManager7=k;this.$RangedCallbackManager8=l;}i.prototype.executeOrEnqueue=function(j,k,l,m,n){"use strict";return this.$RangedCallbackManager4.executeOrEnqueue({start:j,limit:k},l,{strict:!!m,skipOnStrictHandler:n});};i.prototype.unsubscribe=function(j){"use strict";this.$RangedCallbackManager4.unsubscribe(j);};i.prototype.getUnavailableResources=function(j){"use strict";var k=this.$RangedCallbackManager4.getRequest(j),l=[];if(k&&!this.$RangedCallbackManager1){var m=k.request,n=this.$RangedCallbackManager9(k.options),o=m.start+m.limit;for(var p=n.length;p<o;p++)l.push(p);}return l;};i.prototype.addResources=function(j){"use strict";j.forEach(function(k){if(!this.$RangedCallbackManager3[k]){this.$RangedCallbackManager3[k]=true;this.$RangedCallbackManager0.push(k);this.$RangedCallbackManager2=null;}}.bind(this));this.resortResources();this.$RangedCallbackManager4.runPossibleCallbacks();};i.prototype.addResourcesWithoutSorting=function(j,k){"use strict";var l=this.$RangedCallbackManager0.slice(0,k);l=l.concat(j);l=l.concat(this.$RangedCallbackManager0.slice(k));this.$RangedCallbackManager0=l;Object.assign(this.$RangedCallbackManager3,h(j,true));this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();};i.prototype.removeResources=function(j){"use strict";j.forEach(function(k){if(this.$RangedCallbackManager3[k]){this.$RangedCallbackManager3[k]=false;var l=this.$RangedCallbackManager0.indexOf(k);if(l!=-1)this.$RangedCallbackManager0.splice(l,1);}}.bind(this));};i.prototype.removeAllResources=function(){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager3={};};i.prototype.resortResources=function(){"use strict";this.$RangedCallbackManager0=this.$RangedCallbackManager0.sort(function(j,k){return this.$RangedCallbackManager7(this.$RangedCallbackManager6(j),this.$RangedCallbackManager6(k));}.bind(this));};i.prototype.setReachedEndOfArray=function(){"use strict";if(!this.$RangedCallbackManager1){this.$RangedCallbackManager1=true;this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();}};i.prototype.hasReachedEndOfArray=function(){"use strict";return this.$RangedCallbackManager1;};i.prototype.setError=function(j){"use strict";if(this.$RangedCallbackManager2!==j){this.$RangedCallbackManager2=j;this.$RangedCallbackManager4.runPossibleCallbacks();}};i.prototype.getError=function(j,k,l){"use strict";var m=this.$RangedCallbackManager9({strict:l});return j+k>m.length?this.$RangedCallbackManager2:null;};i.prototype.hasResource=function(j){"use strict";return this.$RangedCallbackManager3[j];};i.prototype.getResourceAtIndex=function(j){"use strict";return this.$RangedCallbackManager0[j];};i.prototype.getAllResources=function(){"use strict";return this.$RangedCallbackManager0.concat();};i.prototype.getCurrentArraySize=function(j){"use strict";return this.$RangedCallbackManager9(j).length;};i.prototype.$RangedCallbackManager9=function(j){"use strict";var k=this.$RangedCallbackManager0;if(j&&j.strict){var l=j.skipOnStrictHandler||this.$RangedCallbackManager8;if(l)k=k.filter(l);}return k;};i.prototype.$RangedCallbackManager5=function(j,k){"use strict";var l=this.$RangedCallbackManager9(k);if(!this.$RangedCallbackManager1&&!this.$RangedCallbackManager2&&j.start+j.limit>l.length){return false;}else{var m=l.slice(j.start,j.start+j.limit),n=j.start+j.limit>l.length?this.$RangedCallbackManager2:null;return [m,n];}};i.prototype.getElementsUntil=function(j){"use strict";var k=[];for(var l=0;l<this.$RangedCallbackManager0.length;l++){var m=this.$RangedCallbackManager6(this.$RangedCallbackManager0[l]);if(this.$RangedCallbackManager7(m,j)>0)break;k.push(this.$RangedCallbackManager0[l]);}return k;};e.exports=i;},null);
__d("mergeDeepInto",["invariant","mergeHelpers"],function(a,b,c,d,e,f,g,h){"use strict";var i=h.ArrayStrategies,j=h.checkArrayStrategy,k=h.checkMergeArrayArgs,l=h.checkMergeLevel,m=h.checkMergeObjectArgs,n=h.isTerminal,o=h.normalizeMergeArg,p=function(t,u,v,w){m(t,u);l(w);var x=u?Object.keys(u):[];for(var y=0;y<x.length;y++){var z=x[y];r(t,u,z,v,w);}},q=function(t,u,v,w){k(t,u);l(w);var x=Math.max(t.length,u.length);for(var y=0;y<x;y++)r(t,u,y,v,w);},r=function(t,u,v,w,x){var y=u[v],z=u.hasOwnProperty(v),aa=z&&n(y),ba=z&&Array.isArray(y),ca=z&&!ba&&!ba,da=t[v],ea=t.hasOwnProperty(v),fa=ea&&n(da),ga=ea&&Array.isArray(da),ha=ea&&!ga&&!ga;if(fa){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else if(!z)t[v]=da;}else if(ga){if(aa){t[v]=y;}else if(ba){g(i[w]);if(w===i.Clobber)da.length=0;q(da,y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;}else if(ha){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){p(da,y,w,x+1);}else !z;}else if(!ea)if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;},s=function(t,u,v){var w=o(u);j(v);p(t,w,v,0);};e.exports=s;},null);
__d("mergeDeep",["mergeHelpers","mergeDeepInto"],function(a,b,c,d,e,f,g,h){"use strict";var i=g.checkArrayStrategy,j=g.checkMergeObjectArgs,k=g.normalizeMergeArg,l=function(m,n,o){var p=k(m),q=k(n);j(p,q);i(o);var r={};h(r,p,o);h(r,q,o);return r;};e.exports=l;},null);
__d("mergeObjects",["copyProperties"],function(a,b,c,d,e,f,g){function h(){var i={};for(var j=0;j<arguments.length;j++)g(i,arguments[j]);return i;}e.exports=h;},null);
__d("ReactComponentWithPureRenderMixin",["shallowEqual"],function(a,b,c,d,e,f,g){'use strict';var h={shouldComponentUpdate:function(i,j){return !g(this.props,i)||!g(this.state,j);}};e.exports=h;},null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],function(a,b,c,d,e,f,g,h){'use strict';var i={generateMessageID:function(j){var k=j||Date.now(),l=h(0,4294967295),m=g.getSessionID();return ("<"+k+":"+l+"-"+m+"@mail.projektitan.com>");},generateThreadID:function(j){return 'root:'+i.generateMessageID(j);}};e.exports=i;},null);
__d("MercuryMessageObject",["MercuryActionStatus","MercuryActionType","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercuryMessageSourceTags","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercurySendMessageFields","fbt","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(v){"use strict";this.$MercuryMessageObject0=v;}s.prototype.constructUserGeneratedMessageObject=function(v,w,x,y,z){"use strict";var aa=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);if(typeof v=='string')v=v.replace(/^\s+/,'').replace(/\s+$/,'');aa.body=v;aa.has_attachment=false;aa.html_body=false;aa.attachments=[];aa.specific_to_list=y||[];aa.creator_info=z;return aa;};s.prototype.constructStickerMessageObject=function(v,w,x){"use strict";var y=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);y.has_attachment=true;y.html_body=false;y.attachments=[];y.sticker_id=v;y.specific_to_list=[];return y;};s.prototype.constructAttachmentMessageObject=function(v,w){"use strict";var x=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,v,w);x.attachments=[];x.specific_to_list=[];return x;};s.prototype.constructLogMessageObject=function(v,w,x,y){"use strict";var z=t(this.$MercuryMessageObject0,h.LOG_MESSAGE,v,w);z.log_message_type=x;z.log_message_data=y;return z;};s.prototype.normalizeNewMessage=function(v){"use strict";if(v.status===undefined)v.status=g.UNSENT;v.timestamp_absolute="Today";v.message_id=v.message_id||j.generateMessageID(v.timestamp);var w=i.getParticipantIDFromUserID(this.$MercuryMessageObject0);v.specific_to_list=v.specific_to_list||[];if(v.specific_to_list.length&&v.specific_to_list.indexOf(w)===-1)v.specific_to_list.push(w);if(!v.thread_id){if(v.specific_to_list.length==1){v.thread_id='user:'+this.$MercuryMessageObject0;}else if(v.specific_to_list.length==2){var x=v.specific_to_list[0]==w?v.specific_to_list[1]:v.specific_to_list[0];v.thread_id=i.getThreadIDFromParticipantID(x);}v.thread_id=v.thread_id||'root:'+v.message_id;}if(!v.specific_to_list.length){var y=i.tokenize(v.thread_id),z=y.type,aa=y.value;if(z=='user')v.specific_to_list=['fbid:'+aa,w];}if(!v[p.MANUAL_RETRY_CNT])v[p.MANUAL_RETRY_CNT]=0;};s.prototype.normalizeResendMessage=function(v){"use strict";v.status=g.RESENDING;v.timestamp=Date.now();v[p.MANUAL_RETRY_CNT]+=1;};s.prototype.normalizeAddAttachmentPlaceholder=function(v,w,x){"use strict";if(x.preview_attachments.length>0){v.has_attachment=true;v.preview_attachments=x.preview_attachments;}v.client_state=k.DO_NOT_SEND_TO_SERVER;v.status=g.RESENDING;v.upload_id=w;};function t(v,w,x,y){var z=u(x)?[l.CHAT]:[],aa=Date.now(),ba=r(new Date(aa),'g:ia'),ca={action_type:w,thread_id:y,author:i.getParticipantIDFromUserID(v),author_email:null,coordinates:null,timestamp:aa,timestamp_absolute:(new Date(aa)).toLocaleDateString(),timestamp_relative:ba,timestamp_time_passed:o.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:x,source_tags:z};return ca;}function u(v){switch(v){case n.CHAT_WEB:case n.CHAT_JABBER:case n.CHAT_IPHONE:case n.CHAT_MEEBO:case n.CHAT_ORCA:case n.CHAT_TEST:case n.CHAT:case n.DESKTOP:return true;default:return false;}}Object.assign(s,m);e.exports=s;},null);
__d("MercuryMessageActions",["CurrentUser","MercuryActionType","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(n){this.$MercuryMessageActions0=n;this.$MercuryMessageActions1=i.getForFBID(this.$MercuryMessageActions0);this.$MercuryMessageActions2=k.getForFBID(this.$MercuryMessageActions0);}m.prototype.send=function(n,o,p){o=o||Function.prototype;this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));this.$MercuryMessageActions2.sendNewMessage(n,p);o(n.thread_id);};m.prototype.resend=function(n,o){var p=Object.assign({},n);this.$MercuryMessageActions1.normalizeResendMessage(p);this.send(p,(void 0),o);};m.prototype.addAttachmentPlaceholder=function(n,o,p){this.$MercuryMessageActions1.normalizeAddAttachmentPlaceholder(n,o,p);this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));};m.prototype.cancelAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CANCEL_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.prototype.confirmAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CONFIRM_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.addShareDataToExistingMessage=function(n,o,p,q){q=q||g.getID();m.getForFBID(q).addShareDataToExistingMessage(n,o,p);};m.prototype.addShareDataToExistingMessage=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4({server_id:n,attach_key:o,attach_data:p,action_type:h.ADD_SHARE_DATA_TO_EXISTING_MESSAGE},j.SERVER_ADD_SHARE_DATA_TO_EXISTING_MESSAGE));};m.prototype.markSpam=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.MARK_MESSAGES_SPAM,j.CLIENT_MARK_MESSAGES_SPAM));};m.prototype["delete"]=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.DELETE_MESSAGES,p||j.CLIENT_DELETE_MESSAGES));};m.prototype.$MercuryMessageActions3=function(n,o){return {actions:[n],from_client:true,payload_source:o};};m.prototype.$MercuryMessageActions4=function(n,o){return {actions:[n],from_client:false,payload_source:o};};m.prototype.$MercuryMessageActions5=function(n,o,p,q){return {actions:[{action_type:p,action_id:null,thread_id:n,message_ids:o}],from_client:true,payload_source:q};};Object.assign(m,l);e.exports=m;},null);
__d("MercuryThreadActions",["MercuryActionType","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MessagingTag","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(n){this.$MercuryThreadActions0=n;this.$MercuryThreadActions1=i.getForFBID(this.$MercuryThreadActions0);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3([n],g.MARK_THREAD_SEEN,h.CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.changeThreadArchivedStatus(p,true,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.changeThreadArchivedStatus(p,false,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions4(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.markThreadSpam(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(n,k.SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.unmarkThreadSpam(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(n,k.INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.changeThreadFolder(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions5(n,o));};m.prototype["delete"]=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.$MercuryThreadActions1.deleteThread(p,o);}.bind(this));this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3(n,g.DELETE_THREAD,h.CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.$MercuryThreadActions1.changeMutingOnThread(n,o);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3([n],g.CHANGE_MUTE_SETTINGS,h.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:o}));};m.prototype.addParticipants=function(n,o){this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3([n],g.ADD_PARTICIPANTS,h.CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.unpinThread=function(n){this.$MercuryThreadActions1.unpinThread(n);this.$MercuryThreadActions1.handleUpdate(this.$MercuryThreadActions3([n],g.UNPIN_THREAD,h.CLIENT_UNPIN_THREAD));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.$MercuryThreadActions3(n,g.CHANGE_READ_STATUS,h.CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions4=function(n,o){return this.$MercuryThreadActions3(n,g.CHANGE_ARCHIVED_STATUS,h.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions5=function(n,o){return this.$MercuryThreadActions3(n,g.CHANGE_FOLDER,h.CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.$MercuryThreadActions3=function(n,o,p,q){return {actions:n.map(function(r){return l({action_type:o,action_id:null,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,j);e.exports=m;},null);
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","CurrentUser","DOM"],function(a,b,c,d,e,f,g,h,i,j){var k={getUserIDEmail:function(){return i.getID()+'@facebook.com';},getThreadMuteSettingForUser:function(l){return l.mute_settings&&l.mute_settings[k.getUserIDEmail()];},isThreadMuted:function(l){return k.getThreadMuteSettingForUser(l)!==(void 0);},showMuteChangeDialog:function(l,m){g.send(new h('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(m),function(n){n.subscribe('confirm',function(){this.hide();var o;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(p){if(p.checked)o=p.value;});o=k.convertRawMuteSetting(o);d(['MercuryThreadActions'],function(p){p.get().updateMuteSetting(l,o);});}.bind(n));});},convertRawMuteSetting:function(l){switch(l){case 'always':return -1;case '1hour':return 3600;case '8am':var m,n=new Date(),o=new Date();o.setHours(8);o.setMinutes(0);o.setSeconds(0);if(o>n){m=o-n;}else m=o-n+(24*3600*1000);return m/1000;default:return 0;}}};e.exports=k;},null);
__d("ImageSourceType",[],function(a,b,c,d,e,f){var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;},null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){"use strict";this._request.fbid=r;return this;};n.prototype.setType=function(r){"use strict";if(!l([h.PROFILE_PICTURE,h.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){"use strict";this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){"use strict";if(!l([j.COVER,j.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){"use strict";this._callback=r;return this;};n.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new i();o=r;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.getID(),mode:k.BATCH_DEFERRED_MULTI,batch_function:function(s,t){m(s.requests,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}e.exports=n;},null);
__d("MercuryParticipantFetcher",["MercuryIDs","MercuryPayloadSource","MercuryServerRequests","Set","ShortProfiles","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(o){this.$MercuryParticipantFetcher0=i.getForFBID(o);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new j();this.$MercuryParticipantFetcher3=new j();}m.prototype.fetch=function(o){this.$MercuryParticipantFetcher4(o);this.$MercuryParticipantFetcher5();};m.prototype.fetchMulti=function(o){o.forEach(function(p){return this.$MercuryParticipantFetcher4(p);}.bind(this));this.$MercuryParticipantFetcher5();};m.prototype.$MercuryParticipantFetcher4=function(o){if(!this.$MercuryParticipantFetcher3.has(o))this.$MercuryParticipantFetcher2.add(o);};m.prototype.$MercuryParticipantFetcher5=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;l(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(o){return this.$MercuryParticipantFetcher3.add(o);}.bind(this));this.$MercuryParticipantFetcher6(this.$MercuryParticipantFetcher2,function(o){o.forEach(function(p){return this.$MercuryParticipantFetcher3["delete"](p.id);}.bind(this));this.$MercuryParticipantFetcher7(o);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};m.prototype.$MercuryParticipantFetcher6=function(o,p){var q=[];o.forEach(function(r){var s=g.tokenize(r),t=s.type,u=s.value;t==='fbid'&&q.push(u);});if(q.length>0)k.getMulti(q,function(r){var s=[];for(var t in r)s.push(n(r[t],t));p(s);});};m.prototype.$MercuryParticipantFetcher7=function(o){this.$MercuryParticipantFetcher0.handleUpdate({participants:o,from_client:false,payload_source:h.SERVER_FETCH_PARTICIPANTS});};function n(o,p){var q=Object.assign({gender:o.gender,href:o.uri,id:g.getParticipantIDFromUserID(o.id||p),image_src:o.thumbSrc,name:o.name,short_name:o.firstName,employee:o.employee,is_employee_away:o.is_employee_away,type:o.type,vanity:o.vanity,is_friend:o.is_friend,orion_eligible:o.orionEligible,social_snippets:o.social_snippets},{});if(o.officeStatus){q.officeStatus=o.officeStatus;q.officeStatusStartDate=o.officeStatusStartDate;q.officeStatusEndDate=o.officeStatusEndDate;q.officeStatusComment=o.officeStatusComment;q.officeStatusLocation=o.officeStatusLocation;}return q;}e.exports=m;},null);
__d("MercuryParticipants",["CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","KeyedCallbackManager","Map","MercuryAssert","MercuryIDs","MercuryParticipantFetcher","MercuryParticipantTypes","MercuryParticipantsConstants","MercuryServerRequests","PhotoResizeModeConst","Set","fbt","mapObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){'use strict';var x='change';function y(aa){this.$MercuryParticipants0=aa;this.$MercuryParticipants1=new h();this.$MercuryParticipants2=new l();this.$MercuryParticipants3=new p(this.$MercuryParticipants0);this.$MercuryParticipants4=new m();this.$MercuryParticipants5=s.getForFBID(this.$MercuryParticipants0);this.$MercuryParticipants5.subscribe('update-participants',function(ba,ca){if(ca.participants&&ca.participants.length>0){var da={};ca.participants.forEach(function(ea){da[ea.id]=ea;});this.$MercuryParticipants6(da);}}.bind(this));}y.prototype.addListener=function(aa,ba){return this.$MercuryParticipants1.addListener(aa,ba);};y.prototype.getIDFromVanityOrFBID=function(aa){if(!aa)return;if(this.$MercuryParticipants4.has(aa))return this.$MercuryParticipants4.get(aa);if(/^\d+$/.test(aa))return o.getParticipantIDFromUserID(aa);};y.prototype.getNow=function(aa){return this.$MercuryParticipants7(aa);};y.prototype.getOrFetch=function(aa){var ba=this.$MercuryParticipants7(aa);if(!ba)this.$MercuryParticipants3.fetch(aa);return ba;};y.prototype.get=function(aa,ba){n.isParticipantID(aa);return this.$MercuryParticipants8([aa],function(ca){ba(ca[aa]);});};y.prototype.getMulti=function(aa,ba){return this.$MercuryParticipants8(aa,ba);};y.prototype.getBigImageMulti=function(aa,ba){n.allParticipantIDs(aa);var ca=r.BIG_IMAGE_SIZE;return this.$MercuryParticipants8(aa,function(da){var ea={},fa=0,ga=new u(),ha=function(la,ma){fa++;ea[la]=ma;if(fa===aa.length){ba(ea);if(ga.size>0)this.$MercuryParticipants9(ga);}}.bind(this),ia=function(la,ma){this.$MercuryParticipants2.setResource(la,k.set(this.$MercuryParticipants2.getResource(la),{big_image_src:ma.uri}));ga.add(la);ha(la,ma.uri);}.bind(this);for(var ja in da){var ka=da[ja];if(!ka.big_image_src){new i().setFBID(o.getUserIDFromParticipantID(ja)).setType(j.PROFILE_PICTURE).setDimensions(ca,ca).setResizeMode(t.COVER).setCallback(ia.bind(null,ja)).send();}else ha(ka.id,ka.big_image_src);}}.bind(this));};y.prototype.getOrderedBigImageMulti=function(aa,ba){return this.getBigImageMulti(aa,function(ca){ba(aa.map(function(da){return ca[da];}));});};y.prototype.$MercuryParticipants8=function(aa,ba){n.allParticipantIDs(aa);var ca=this.$MercuryParticipants2.executeOrEnqueue(aa,ba),da=this.$MercuryParticipants2.getUnavailableResources(ca).filter(function(ea){var fa=o.tokenize(ea),ga=fa.type,ha=fa.value;if(ga==='email'){this.$MercuryParticipantsa(ea,ha);return false;}return true;}.bind(this));this.$MercuryParticipants3.fetchMulti(da);return this.$MercuryParticipantsb(ca);};y.prototype.$MercuryParticipants7=function(aa){var ba=this.$MercuryParticipants2.getResource(aa);if(!ba){var ca=o.tokenize(aa),da=ca.type,ea=ca.value;if(da==='email')ba=this.$MercuryParticipantsa(aa,ea);}return ba;};y.prototype.$MercuryParticipantsa=function(aa,ba){var ca=new k(z(aa,ba));this.$MercuryParticipants2.setResource(aa,ca);return ca;};y.prototype.$MercuryParticipants9=function(aa){this.$MercuryParticipants1.emit(x,aa);};y.prototype.$MercuryParticipants6=function(aa){aa=w(aa,function(ba,ca){if(ba.vanity)this.$MercuryParticipants4.set(ba.vanity,ca);return new k(this.$MercuryParticipantsc(ba));}.bind(this));this.$MercuryParticipants2.addResourcesAndExecute(aa);this.$MercuryParticipants9(new u(Object.keys(aa)));};y.prototype.$MercuryParticipantsc=function(aa){var ba=aa.type===q.USER||aa.type===q.FRIEND;if(!ba)return aa;if(!aa.name&&!aa.href&&!aa.vanity){var ca="Facebook User";aa.name=ca;aa.short_name=ca;}return aa;};y.prototype.$MercuryParticipantsb=function(aa){return {remove:function(){this.$MercuryParticipants2.unsubscribe(aa);}.bind(this)};};function z(aa,ba){return {gender:r.UNKNOWN_GENDER,href:null,id:aa,image_src:r.EMAIL_IMAGE,big_image_src:r.EMAIL_IMAGE,name:ba,short_name:ba,employee:false};}e.exports=new y(g.getID());},null);
__d("MercuryAttachmentSnippet.react",["EmoticonsList","Image.react","MercuryAttachment","MercuryAttachmentType","MercuryConstants","MercuryIDs","MercuryParticipants","React","StickerConstants","TextWithEmoticons.react","cx","fbt","ix","joinClasses","OrionMercuryAttachmentSnippet"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';var u=b('OrionMercuryAttachmentSnippet').module,v=n.createClass({displayName:"MercuryAttachmentSnippet",propTypes:{thread:n.PropTypes.object.isRequired,viewer:n.PropTypes.string.isRequired},componentWillMount:function(){this._ensureParticipant(this.props.thread.snippet_sender);this._setVariables(this.props);},componentWillReceiveProps:function(aa){this._ensureParticipant(aa.thread.snippet_sender);this._setVariables(aa);},componentWillUnmount:function(){this._cancelParticipantFetch();},render:function(){var aa=this._getSenderName();if(this._hasOnlyPhotos())return this._renderPhotoSnippet(aa);if(this._hasOnlyAnimatedImages())return this._renderAnimatedImageSnippet(aa);if(this._hasOnlyVideo())return this._renderVideoSnippet(aa);if(this._hasAudioClip())return this._renderAudioClipSnippet(aa);if(this._hasSticker())return this._renderStickerSnippet(aa);if(this._hasOrion())return this._renderOrionSnippet(aa);if(this._hasShoerackInvitation())return this._renderShoerackInvitationSnippet(aa);if(this._hasShare())return this._renderShareSnippet(aa);return this._renderMixedSnippet(aa);},_renderPhotoSnippet:function(aa){var ba;if(this._photos.length===1){if(this._isViewerSender){ba=("You sent a photo.");}else ba=(r._("{name} sent a photo.",[r.param("name",aa)]));}else if(this._isViewerSender){ba=(r._("You sent {num_photos} photos.",[r.param("num_photos",this._photos.length)]));}else ba=(r._("{name} sent {num_photos} photos.",[r.param("name",aa),r.param("num_photos",this._photos.length)]));return this._renderSnippet(ba);},_renderAnimatedImageSnippet:function(aa){var ba;if(this._animatedImages.length===1){if(this._isViewerSender){ba=("You sent a GIF.");}else ba=(r._("{name} sent a GIF.",[r.param("name",aa)]));}else if(this._isViewerSender){ba=(r._("You sent {num_animated_images} GIFs.",[r.param("num_animated_images",this._animatedImages.length)]));}else ba=(r._("{name} sent {num_animated_images} GIFs.",[r.param("name",aa),r.param("num_animated_images",this._animatedImages.length)]));return this._renderSnippet(ba);},_renderVideoSnippet:function(aa){var ba;if(this._isViewerSender){ba=("You sent a video.");}else ba=(r._("{sender name} sent a video.",[r.param("sender name",aa)]));return this._renderSnippet(ba);},_renderAudioClipSnippet:function(aa){var ba;if(this._isViewerSender){ba=("You sent a voice message.");}else ba=(r._("{name} sent a voice message.",[r.param("name",aa)]));return this._renderSnippet(ba);},_renderStickerSnippet:function(aa){if(y(this._attachments[0].metadata.stickerID)){return (n.createElement(p,{renderEmoticons:true,text:g.symbols.like}));}else if(this._isViewerSender){return (n.createElement("span",null,"You sent a sticker."));}else return (n.createElement("span",null,r._("{name} sent a sticker.",[r.param("name",aa)])));},_renderOrionSnippet:function(aa){if(!u)return null;return (n.createElement("span",null,n.createElement(u,n.__spread({},this._attachments[0].metadata))));},_renderShoerackInvitationSnippet:function(aa){var ba;if(this._isViewerSender){ba=("You sent a Moments invitation.");}else ba=(r._("{sender name} invited you to share photos using Moments.",[r.param("sender name",aa)]));return this._renderSnippet(ba);},_renderShareSnippet:function(aa){var ba;if(this._isViewerSender){ba=("You shared a link.");}else ba=(r._("{sender name} shared a link.",[r.param("sender name",aa)]));return this._renderSnippet(ba);},_renderMixedSnippet:function(aa){return (n.createElement("span",null,this._attachments.filter(function(ba){return ba.attach_type===j.FILE||ba.attach_type===j.PHOTO||ba.attach_type===j.VIDEO;}).map(function(ba){return this._renderSnippet(ba.name,ba.icon_type);}.bind(this))));},_renderSnippet:function(aa,ba){var ca=i.getAttachIconClass(ba||this._attachments[0].icon_type),da=t(ca,"uiIconText _3l6h");return (n.createElement("span",{className:da},n.createElement(h,{src:s('/images/messaging/docs/generic.png')}),aa));},_hasOnlyPhotos:function(){return this._photos.length===this._attachments.length;},_hasOnlyAnimatedImages:function(){return this._animatedImages.length===this._attachments.length;},_hasOnlyVideo:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.VIDEO);},_hasAudioClip:function(){return !!(this._attachments.length===1&&this._attachments[0].metadata&&i.isVoiceMessage(this._attachments[0].metadata.type));},_hasSticker:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.STICKER);},_hasOrion:function(){return this._hasSingleAttachmentOfShareDataType(k.MercurySupportedShareType.FB_ORION);},_hasShoerackInvitation:function(){return this._hasSingleAttachmentOfShareDataType(k.MercurySupportedShareType.FB_SHOERACK_INVITATION);},_hasSingleAttachmentOfShareDataType:function(aa){return (this._attachments.length===1&&this._attachments[0].share_data_type===aa);},_hasShare:function(){return (this._attachments.length===1&&this._attachments[0].attach_type===j.SHARE);},_setVariables:function(aa){this._viewer=aa.viewer;this._sender=aa.thread.snippet_sender;this._attachments=aa.thread.snippet_attachments;this._photos=w(this._attachments);this._animatedImages=x(this._attachments);this._isViewerSender=z(this._sender,this._viewer);},_getSenderName:function(){if(!this._sender||this._isViewerSender)return null;var aa=m.getNow(this._sender);if(!aa)return null;return aa.short_name;},_ensureParticipant:function(aa){if(!aa)return;this._cancelParticipantFetch();if(!m.getNow(aa))this._sub=m.get(aa,function(ba){return this.forceUpdate();}.bind(this));},_cancelParticipantFetch:function(){this._sub&&this._sub.remove();}});function w(aa){if(!aa)return [];return aa.filter(function(ba){return ba.attach_type===j.PHOTO;});}function x(aa){if(!aa)return [];return aa.filter(function(ba){return ba.attach_type===j.ANIMATED_IMAGE;});}function y(aa){return (aa==o.LIKE_STICKER_ID||aa==o.HOT_LIKE_SMALL_STICKER_ID||aa==o.HOT_LIKE_MEDIUM_STICKER_ID||aa==o.HOT_LIKE_LARGE_STICKER_ID);}function z(aa,ba){return !!(aa&&l.getParticipantIDFromUserID(ba)==aa);}e.exports=v;},null);
__d("MercuryThreadImage.react",["ImmutableObject","MercuryIDs","MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","SplitImage.react","areEqual"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=l.createClass({displayName:"MercuryThreadImage",propTypes:{thread:l.PropTypes.instanceOf(g).isRequired,viewer:l.PropTypes.string.isRequired,size:l.PropTypes.number},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(p,q){this._getParticipantImages(p);},shouldComponentUpdate:function(p,q){return (p.thread.image_src!==this.props.thread.image_src||p.size!==this.props.size||!n(q.participantImages,this.state.participantImages));},render:function(){var p=this.props.size||j.BIG_IMAGE_SIZE;if(this.props.thread.image_src)return (l.createElement(k,{height:p,resizeMode:'cover',src:this.props.thread.image_src,width:p}));if(this.state.participantImages.length>0)return (l.createElement(m,{srcs:this.state.participantImages,border:true,size:p}));return null;},_getParticipantImages:function(p){var q=p.thread,r=p.viewer;if(q.image_src)return;var s=h.getParticipantIDFromUserID(r),t=q.participants.filter(function(v){return v!=s;}),u=[];if(!t.length){u=[s];}else if(t.length==1){u=t;}else u=t.slice(0,3);i.getOrderedBigImageMulti(u,function(v){this.isMounted()&&this.setState({participantImages:v});}.bind(this));}});e.exports=o;},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=function(r){return this.$MercuryParticipantListRenderer1?r.short_name:r.name;}.bind(this);}h.prototype.renderParticipantList=function(r){var s=r.map(this.$MercuryParticipantListRenderer3);switch(s.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(s);case 2:return this.$MercuryParticipantListRenderer2?l(s):k(s);case 3:return this.$MercuryParticipantListRenderer2?n(s):m(s);default:return this.$MercuryParticipantListRenderer2?p(s):o(s);}};h.prototype.setIsNewThread=function(r){this.$MercuryParticipantListRenderer0=r;return this;};h.prototype.setNameRenderer=function(r){this.$MercuryParticipantListRenderer3=r;return this;};h.prototype.setUseShortName=function(r){this.$MercuryParticipantListRenderer1=r;return this;};h.prototype.setUseAndSeparator=function(r){this.$MercuryParticipantListRenderer2=r;return this;};function i(r){if(r){return ("New Message");}else return ("No Participants");}function j(r){return r[0];}function k(r){return (g._("{participant1}, {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function l(r){return (g._("{participant1} and {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function m(r){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function n(r){return (g._("{participant1}, {participant2} and {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function o(r){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2]),g.param("others_link",q(r.length-3))]));}function p(r){return (g._("{participant1}, {participant2} and {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("others_link",q(r.length-2))]));}function q(r){if(r>1){return (g._("{others_count} others",[g.param("others_count",r)]));}else return ("1 other");}e.exports=h;},null);
__d("MercuryThreadTitle.react",["MercuryIDs","MercuryParticipantListRenderer","MercuryParticipants","React","TextWithEmoticons.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m=j.createClass({displayName:"MercuryThreadTitle",propTypes:{isNewThread:j.PropTypes.bool,thread:j.PropTypes.object.isRequired,viewer:j.PropTypes.string.isRequired,showUnreadCount:j.PropTypes.bool,useShortName:j.PropTypes.bool,useAndSeparator:j.PropTypes.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(n){this._renderParticipantsList(n);},render:function(){return (j.createElement("span",{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var n=this.props.thread,o=j.createElement(k,{renderEmoticons:true,renderEmoji:true,text:n.name});if(!n.unread_count||!this.props.showUnreadCount)return o;return this._renderTitleWithUnreadCount(o,n.unread_count);},_renderParticipantsList:function(n){if(n.thread.name)return;var o=g.getParticipantIDFromUserID(n.viewer),p=n.thread.participants;if(p.length>1)p=p.filter(function(q){return q!=o;});i.getMulti(p,function(q){if(!this.isMounted())return;var r=p.map(function(u){return q[u];}),s=new h().setUseShortName(this.props.useShortName).setUseAndSeparator(this.props.useAndSeparator).setIsNewThread(this.props.isNewThread).renderParticipantList(r),t=(n.showUnreadCount&&n.thread.unread_count)?this._renderTitleWithUnreadCount(s,n.thread.unread_count):s;this.setState({participantNames:t});}.bind(this));},_renderTitleWithUnreadCount:function(n,o){return (l._("{conversation-title} ({unread-count})",[l.param("conversation-title",n),l.param("unread-count",o)]));}});e.exports=m;},null);
__d("WebMessengerThreadPermalinks",["MercuryIDs","MessagingTag","URI","WebMessengerPermalinkConstants","WWWBase","requireWeak"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m={getThreadURI:function(q,r,s){if(g.isCanonical(q)){n(q,r,s);}else o(q,r,s);}};function n(q,r,s){var t=new i(k.uri),u=g.tokenize(q).value;t.setPath(p(s)+'/'+u);r&&r(t.toString());}function o(q,r,s){l(['MercuryServerRequests'],function(t){var u=t.get();u.getServerThreadID(q,function(v){var w=new i(k.uri);w.setPath(j.getURIPathForThreadID(v,p(s)));r&&r(w.toString());});});}function p(q){var r=j.BASE_PATH;if(q&&q!=h.INBOX)r+='/'+q;return r;}e.exports=m;},null);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],function(a,b,c,d,e,f,g,h){'use strict';var i='fbid:'+g.getID(),j={getID:function(){return i;},isViewer:function(k){h.isParticipantID(k);return k===i;}};e.exports=j;},null);
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","LogHistory","Map","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryAttachmentType","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySingletonMixin","MercuryViewer","MercuryMessageActions","MercuryMessageIDs","RangedCallbackManager","ReportState","MercurySendMessageFields","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","copyProperties","debounceAcrossTransitions","invariant","isNode","mergeDeep"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){'use strict';var ia=j.getInstance('mercury_messages');function ja(wa,xa){var ya=xa;if(wa._localIdsMap[xa])ya=wa._localIdsMap[xa];return wa._messages.get(ya);}function ka(wa){switch(wa){case r.UNKNOWN:case r.SERVER_INITIAL_DATA:case r.SERVER_FETCH_THREAD_INFO:case r.SERVER_THREAD_SYNC:return true;}return false;}function la(wa){return wa&&wa.substr(0,6)==='server';}function ma(wa,xa){if(!wa._threadsToMessages[xa])wa._threadsToMessages[xa]=new w(function(ya){return ja(wa,ya).timestamp;},function(ya,za){return za-ya;});return wa._threadsToMessages[xa];}function na(wa){var xa=[];return JSON.stringify(wa,function(ya,za){if(typeof za==='object'&&za!==null){if(ga(za))return '<'+za.nodeName+'>';if(xa.indexOf(za)!==-1)return 'CIRCULAR';xa.push(za);}return za;});}x.registerCallback('mercury-messages',function(){var wa={},xa={},ya=pa._getInstances();for(var za in ya){wa[za]={};ya[za]._messages.forEach(function(bb,cb){if(Object.keys(bb).length===0)return;var db=bb.thread_id;wa[za][db]=wa[za][db]||{};wa[za][db][bb.message_id]=JSON.parse(na(bb));});xa[za]=Object.assign({},ya[za]._localIdsMap);}var ab={};ab.local_message_ids=xa;ab.messages=wa;return ab;});function oa(wa,xa,ya){xa.forEach(function(za){var ab=ma(wa,za);ab.setReachedEndOfArray();wa._threadInformer.reorderedMessages(za,ya);});}function pa(wa){this._fbid=wa;this._messageActions=u.getForFBID(this._fbid);this._serverRequests=z.getForFBID(this._fbid);this._threadInformer=ba.getForFBID(this._fbid);this._threads=ca.getForFBID(this._fbid);this._threadActions=aa.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new k();this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(xa,ya){var za=(ya.actions||[]).filter(function(bb){var cb=bb.action_type,db=((bb.is_forward||bb.thread_id)&&(cb==m.LOG_MESSAGE||cb==m.USER_GENERATED_MESSAGE||cb==m.SEND_MESSAGE||cb==m.CLEAR_CHAT||cb==m.DELETE_THREAD||cb==m.DELETE_MESSAGES||cb==m.MARK_MESSAGES_SPAM)),eb=((bb.upload_id&&bb.upload_data)&&(cb==m.CANCEL_ATTACHMENT_PLACEHOLDER||cb==m.CONFIRM_ATTACHMENT_PLACEHOLDER)),fb=(cb==m.ADD_SHARE_DATA_TO_EXISTING_MESSAGE&&(bb.server_id&&bb.attach_key&&bb.attach_data));return (db||eb||fb);}),ab=ka(ya.payload_source);if(la(ya.payload_source))za.forEach(function(bb){if(!bb.is_forward&&bb.action_type!==m.ADD_SHARE_DATA_TO_EXISTING_MESSAGE){var cb=this._threads.getThreadMetaNow(bb.thread_id);if(cb)bb.is_cleared=bb.timestamp<cb.chat_clear_time;}}.bind(this));this.handleUpdates(za,ab,ya.payload_source,ya.from_client);if(ya.end_of_history)oa(this,ya.end_of_history,ya.payload_source);}.bind(this));ia.debug('constructed',{fbid:this._fbid});}da(pa.prototype,{getMessagesFromIDs:function(wa){return (wa||[]).map(ja.bind(null,this)).filter(function(xa){return xa;});},hasLoadedNMessages:function(wa,xa){var ya=ma(this,wa);return ya.hasReachedEndOfArray()||ya.getCurrentArraySize()>=xa;},hasLoadedExactlyNMessages:function(wa,xa){var ya=ma(this,wa);return ya.getCurrentArraySize()==xa;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new k();this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(wa,xa,ya,za,ab,bb){var cb=ma(this,wa),db=function(lb){za(qa(this,lb));}.bind(this),eb=cb.executeOrEnqueue(xa,ya,db),fb=cb.getUnavailableResources(eb),gb=this._failedHistoryFetchThreads[wa];if(fb.length&&!gb){var hb=cb.getCurrentArraySize(),ib=this._localTitanMessagesCount[wa]||0,jb=hb-ib,kb=fb.length+ib;ia.debug('fetch_missing_messages',{threadID:wa,offset:xa,limit:ya,missingIndices:fb,messageCount:hb,localMessageCount:ib});this._serverRequests.fetchThreadMessages(wa,jb,kb,ab,bb);}else this._failedHistoryFetchThreads[wa]=false;return eb;},getThreadMessagesSinceTimestamp:function(wa,xa){var ya=ma(this,wa),za=ya.getElementsUntil(xa);return qa(this,za);},hasLoadedAllMessages:function(wa){return ma(this,wa).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(wa){var xa=ma(this,wa).getAllResources();return qa(this,xa);},unsubscribe:function(wa,xa){n.isThreadID(xa);var ya=ma(this,xa);ya.unsubscribe(wa);},_addNewMessage:function(wa,xa){ta(this,xa);this._messages.set(wa,xa);},_addAttachmentData:function(wa,xa,ya){var za=ja(this,wa);if(za){var ab=za.attachments.indexOf(xa);if(ab!=-1){this._messages.set(wa,Object.assign({},za,{attachments:za.attachments.map(function(bb,cb){return cb===ab?ya:bb;})}));this._threadInformer.updatedMessage(za.thread_id,za.message_id,'attach');}}else{if(!this._attachmentData[wa])this._attachmentData[wa]=[];this._attachmentData[wa].push({attach_key:xa,data:ya});}},_shouldSortOutOfOrderMessages:function(wa,xa,ya){if(wa==r.CLIENT_CHANNEL_MESSAGE){var za=this.getThreadMessagesSinceTimestamp(xa,ya);if(za.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},_preprocessIncomingAction:function(wa,xa){var ya=wa.action_type;if(xa==r.CLIENT_CHANNEL_MESSAGE&&ya==m.USER_GENERATED_MESSAGE&&wa.threading_id&&this._localIdsMap[wa.threading_id]===wa.threading_id){wa.client_message_id=wa.threading_id;wa.status=l.SUCCESS;wa.action_type=m.SEND_MESSAGE;ya=wa.action_type;}if(xa===r.CLIENT_CHANNEL_MESSAGE&&ya==m.USER_GENERATED_MESSAGE){var za=this._threads.getThreadMetaNow(wa.thread_id);if(za&&za.folder)wa.folder=za.folder;}return wa;},handleUpdates:function(wa,xa,ya,za){var ab,bb={},cb={};for(var db=0;db<wa.length;db++){var eb=this._preprocessIncomingAction(wa[db],ya),fb=eb.action_type,gb=ja(this,eb.message_id);if(eb.is_forward||ya==r.SERVER_SEARCH){if(!this._messages.has(eb.message_id))this._addNewMessage(eb.message_id,eb);continue;}else if(eb.client_state===q.SEND_TO_SERVER){this._addNewMessage(eb.message_id,eb);continue;}else if(fb==m.SEND_MESSAGE){var hb=eb.client_message_id;if(hb&&this._localIdsMap[hb]&&eb.status){var ib=ja(this,hb),jb=ib.status;if(ib.status==l.SUCCESS)continue;if(eb.status==l.UNCONFIRMED){if(!cb[eb.thread_id])cb[eb.thread_id]=[];cb[eb.thread_id].push(hb);}else if(!bb[eb.thread_id])bb[eb.thread_id]=[];this._updateLocalMessage(eb);if(typeof jb!==(void 0)||eb.status==l.FAILED_UNKNOWN_REASON||eb.status==l.UNABLE_TO_CONFIRM||eb.status==l.SUCCESS||eb.status==l.ERROR)this._threadInformer.updatedMessage(eb.thread_id,ja(this,hb).message_id,ya);}continue;}else if(fb==m.DELETE_THREAD){ma(this,eb.thread_id).removeAllResources();continue;}else if(fb==m.DELETE_MESSAGES){this._deleteMessages(eb.thread_id,eb.message_ids,ya);continue;}else if(fb==m.CLEAR_CHAT){var kb=ma(this,eb.thread_id).getAllResources();kb.map(ja.bind(null,this)).forEach(function(qb){qb.is_cleared=true;});continue;}else if(fb===m.MARK_MESSAGES_SPAM){this._markMessagesSpam(eb,ya);continue;}else if((eb.threading_id&&this._localIdsMap[eb.threading_id])||(gb&&!gb.is_forward)){if(gb&&eb.ranges&&eb.ranges.length>0){var lb=gb.message_id;this._messages.set(this._localIdsMap[lb]||lb,Object.assign({},gb,{ranges:eb.ranges}));this._threadInformer.updatedMessage(gb.thread_id,gb.message_id,'link_shim');}continue;}else if(fb===m.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(eb.upload_id,eb.upload_data);continue;}else if(fb===m.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(eb.upload_id,eb.upload_data);continue;}else if(fb===m.ADD_SHARE_DATA_TO_EXISTING_MESSAGE){this._addAttachmentData(eb.server_id,eb.attach_key,eb.attach_data);continue;}else{if(ya===r.CLIENT_SEND_MESSAGE){this._localIdsMap[eb.message_id]=eb.message_id;if(eb.thread_id=='root:'+eb.message_id)ma(this,eb.thread_id).setReachedEndOfArray();}if(fb==m.LOG_MESSAGE&&eb.log_message_type==p.SERVER_ERROR)this._failedHistoryFetchThreads[eb.thread_id]=true;if(eb.client_state===q.DO_NOT_SEND_TO_SERVER&&eb.upload_id)this._uploadMessages[eb.upload_id]=eb;if(!bb[eb.thread_id])bb[eb.thread_id]=[];bb[eb.thread_id].push(eb.message_id);this._addNewMessage(eb.message_id,eb);if(eb.threading_id&&eb.threading_id!=eb.message_id)v.addServerID(eb.threading_id,eb.message_id);if(eb[y.MANUAL_RETRY_CNT]>0){ab=ma(this,eb.thread_id);ab.resortResources([eb.message_id]);this._threadInformer.reorderedMessages(eb.thread_id,r.CLIENT_SEND_MESSAGE);}xa=xa||this._shouldSortOutOfOrderMessages(ya,eb.thread_id,eb.timestamp);if(!xa)this._threadInformer.receivedMessage(eb);continue;}}for(var mb in bb){ab=ma(this,mb);var nb=ab.getAllResources(),ob=nb.filter(function(qb){var rb=this._messages.get(qb);return rb.action_type==m.LOG_MESSAGE&&rb.log_message_type==p.SERVER_ERROR;}.bind(this));ab.removeResources(ob);if(za)ra(this,mb,bb[mb]);if(xa){ab.addResources(bb[mb]);this._threadInformer.reorderedMessages(mb,ya);}else ab.addResourcesWithoutSorting(bb[mb].reverse(),0);this._threadInformer.updatedThread(mb);}var pb=Object.keys(cb);if(pb.length)this._serverRequests.requestMessageConfirmation(cb);ia.debug('handle_updates',{localMessageCounts:ha(this._localTitanMessagesCount)});},isOutbound:function(wa){return wa.author==t.getID();},isInbound:function(wa){return !this.isOutbound(wa);},isSending:function(wa){return (wa.status===l.UNSENT||wa.status===l.UNCONFIRMED||wa.status===l.UNABLE_TO_CONFIRM||wa.status===l.RESENDING);},isFirstMessage:function(wa){var xa=ma(this,wa.thread_id);if(xa.getCurrentArraySize()===0)return false;var ya=xa.getResourceAtIndex(xa.getCurrentArraySize()-1),za=ja(this,ya).message_id,ab=ja(this,wa.message_id).message_id;return xa.hasReachedEndOfArray()&&za==ab;},_markMessagesSpam:function(wa,xa){var ya=wa,za=ya.thread_id,ab=ya.message_ids;if(!ab.length)return;this._deleteIndividualMessages(za,ab,xa);this._serverRequests.markMessagesSpam(za,ab);},_deleteMessages:function(wa,xa,ya){if(!xa.length)return;this._deleteIndividualMessages(wa,xa,ya);if(ya!==r.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(wa,xa);},_deleteIndividualMessages:function(wa,xa,ya){var za=xa.map(function(bb){return ja(this,bb).message_id;},this),ab=ma(this,wa);ab.removeResources(za);this._threadInformer.reorderedMessages(wa,ya);},_updateLocalMessage:function(wa){var xa=ja(this,wa.client_message_id),ya={};ya.status=wa.status;if(wa.status===l.SUCCESS||wa.error_data)ya.error_data=wa.error_data;var za=wa.message_id,ab=wa.client_message_id;if(this._messages.has(za)){this._messages.set(za,Object.assign({},xa,ya));return false;}if(wa.timestamp)ya.timestamp=wa.timestamp;if(wa.log_message_data)ya.log_message_data=wa.log_message_data;if(wa.ranges&&wa.ranges.length)ya.ranges=wa.ranges;if(wa.attachments&&wa.attachments.length){ya.raw_attachments=null;ya.attachments=wa.attachments;ta(this,ya,za);}this._localIdsMap[ab]=za;v.addServerID(ab,za);var bb=Object.assign({},xa,ya);this._messages.set(za,bb);this._messages.set(ab,{});if(sa(bb))this._localTitanMessagesCount[bb.thread_id]--;return true;},getNumberLocalMessages:function(wa){return this._localTitanMessagesCount[wa]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(wa,xa){var ya=this._popPendingAttachmentMessage(wa,xa);this._serverRequests.sendNewMessage(ya);},_cancelAttachmentPlaceholder:function(wa,xa){var ya=this._popPendingAttachmentMessage(wa,xa);this._deleteIndividualMessages(ya.thread_id,[ya.message_id]);if(this._localTitanMessagesCount[ya.thread_id])this._localTitanMessagesCount[ya.thread_id]--;},_popPendingAttachmentMessage:function(wa,xa){var ya=this._uploadMessages[wa];fa(ya);ya.image_ids=xa.image_ids;ya.file_ids=xa.file_ids;ya.audio_ids=xa.audio_ids;ya.gif_ids=xa.gif_ids;ya.client_state=q.SEND_TO_SERVER;delete this._uploadMessages[wa];return ya;}});Object.assign(pa,s);function qa(wa,xa){var ya=xa.map(ja.bind(null,wa));return ya.reverse();}function ra(wa,xa,ya){var za=ya.filter(function(ab){return sa(ja(wa,ab));});if(!wa._localTitanMessagesCount[xa])wa._localTitanMessagesCount[xa]=0;wa._localTitanMessagesCount[xa]+=za.length;}function sa(wa){var xa=wa.action_type;if(xa==m.USER_GENERATED_MESSAGE)return true;switch(wa.log_message_type){case p.SUBSCRIBE:case p.UNSUBSCRIBE:case p.SERVER_ERROR:case p.LIVE_LISTEN:return false;default:return true;}}function ta(wa,xa,ya){ya=ya||xa.message_id;var za=wa._attachmentData[ya];if(za){za.forEach(function(ab){var bb=xa.attachments.indexOf(ab.attach_key);if(bb!==-1)xa.attachments[bb]=ab.data;});delete wa._attachmentData[ya];}else if(!xa.is_forward&&ua(wa,xa)){wa._messagesNeedingAttachmentData[ya]=true;va(wa);}}function ua(wa,xa){if(!xa||!xa.attachments)return false;for(var ya=0;ya<xa.attachments.length;ya++){var za=xa.attachments[ya];if(typeof za==='string'&&za.indexOf(o.SHARE)===0)return true;}var ab=xa.forward_message_ids||[];for(ya=0;ya<ab.length;ya++){var bb=ja(wa,ab[ya]);if(ua(wa,bb))return true;}return false;}var va=ea(function(wa){var xa={};for(var ya in wa._messagesNeedingAttachmentData){var za=ja(wa,ya);if(ua(wa,za))xa[ya]=true;}var ab=Object.keys(xa);if(ab.length){var bb={message_ids:ab};if(wa._fbid!=i.getID())bb.request_user_id=wa._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(bb).setAllowCrossPageTransition(true).send();}wa._messagesNeedingAttachmentData={};},0,this);e.exports=pa;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionType","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","MercuryViewer","MessagingEvent","MessagingReliabilityLogger","MessagingTag","PresenceUtil","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=v(n);for(var x in w)if(w.hasOwnProperty(x))z[x]=w[x];var y=w===null?null:w.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=w;function z(aa){"use strict";this.$MercuryChannelHandler0=aa;this.$MercuryChannelHandler1=m.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=o.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=k.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler4=[];}z.prototype.getInstanceFBID=function(){"use strict";return this.$MercuryChannelHandler0;};z.prototype.$MercuryChannelHandler5=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!ba.obj.message){r.addEntry('channel_receive','invalid_data');return;}var ca=ba.obj.message,da=ca.other_user_fbid?ca.other_user_fbid:ca.thread_fbid,ea={author:ca.mercury_author_id,author_email:ca.mercury_author_email,body:ca.body,subject:ca.subject,has_attachment:ca.has_attachment,attachments:ca.attachments,html_body:ca.html_body,thread_id:ca.tid,thread_fbid:ca.thread_fbid,other_user_fbid:ca.other_user_fbid,message_id:ca.mid,coordinates:ca.mercury_coordinates,is_spoof_warning:ca.is_spoof_warning,ranges:ca.ranges,source:ca.mercury_source,source_tags:ca.mercury_source_tags,threading_id:ca.threading_id,timestamp:ca.timestamp,timestamp_absolute:ca.timestamp_absolute,timestamp_relative:ca.timestamp_relative,timestamp_time_passed:ca.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ca.is_unread,is_forward:false,forward_count:ca.forward_count||ca.forward,forward_message_ids:ca.forward_msg_ids,location_text:ca.location_text,folder:ba.obj.folder};if("sync_id" in ca){ea.sync_id=ca.sync_id;}else ea.action_id=ca.action_id;var fa=[u({},ea)];fa=fa.concat(ca.forward_actions||[]);var ga=l.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:fa,payload_source:ga},da);if(!ca.is_unread&&p.isViewer(ca.mercury_author_id)){var ha={};ha[da]=ba.obj.folder;this.$MercuryChannelHandler7(this.__getMessagingPayloadType(),{obj:{event:q.READ,thread_fbids:ca.thread_fbid?[ca.thread_fbid]:[],other_user_fbids:ca.other_user_fbid?[ca.other_user_fbid]:[],folder_info:ha,timestamp:ca.timestamp}});}r.addEntry('channel_receive','success',[da,ea.message_id,t.getSessionID()]);};z.prototype.$MercuryChannelHandler7=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=[],da=ba.obj.event==q.READ;(ba.obj.thread_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});(ba.obj.other_user_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});this.$MercuryChannelHandler1.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler8=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!(ba.obj.thread_fbids||ba.obj.other_user_fbids))return;var ca=[];(ba.obj.thread_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:da});});(ba.obj.other_user_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:da});});this.$MercuryChannelHandler1.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler9=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids)||!ba.obj.mids)return;var ca=ba.obj.thread_fbids.length?ba.obj.thread_fbids[0]:null,da=ba.obj.other_user_fbids.length?ba.obj.other_user_fbids[0]:null,ea={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:ca,other_user_fbid:da,message_ids:ba.obj.mids};this.$MercuryChannelHandler1.handleUpdate({actions:[ea],threads:[ba.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandlera=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||!ba.obj.folder)return;var ca={action_type:j.MARK_ALL_READ,action_id:ba.obj.action_id,folder:ba.obj.folder};this.$MercuryChannelHandler1.handleUpdate({global_actions:[ca]});};z.prototype.$MercuryChannelHandlerb=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE;(ba.obj.thread_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:da,other_user_fbid:null,archived:ba.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);(ba.obj.other_user_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:da,archived:ba.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);};z.prototype.$MercuryChannelHandlerc=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE,da;(ba.obj.thread_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:ea,other_user_fbid:null,new_folder:da};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);(ba.obj.other_user_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:ea,thread_fbid:null,new_folder:da};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);};z.prototype.$MercuryChannelHandlerd=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj.tag)return;switch(ba.obj.tag){case s.ACTION_ARCHIVED:this.$MercuryChannelHandlerb(aa,ba);break;case s.INBOX:case s.OTHER:this.$MercuryChannelHandlerc(aa,ba);break;}};z.prototype.__markAsSeen=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlere(aa)||!ba.obj||!ba.obj.seen_timestamp)return;this.$MercuryChannelHandler1.handleUpdate({message_counts:[{seen_timestamp:ba.obj.seen_timestamp,folder:s.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:s.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__updateModelsFromMercuryPayload=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlerf(aa)||!ba.obj)return;this.$MercuryChannelHandler2.synchronizeInforms(function(){var ca=ba.obj,da=[];(ca.actions||[]).forEach(function(ea){var fa=i.USER_GENERATED_MESSAGE;if(ea.action_type==i.LOG_MESSAGE){var ga=l.CLIENT_CHANNEL_MESSAGE,ha;ha=ea.other_user_fbid||ea.thread_fbid;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ga},ha);}else if(ea.action_type!=fa)da.push(ea);},this);ca.actions=da;ca.payload_source=l.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdate(ca);}.bind(this));};z.prototype.$MercuryChannelHandlerg=function(aa,ba){"use strict";this.$MercuryChannelHandler1.handleRoger(ba.obj);};z.prototype.$MercuryChannelHandlerh=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler6(aa)||!ba.obj||ba.obj.mute_settings===(void 0)||(!ba.obj.thread_fbid&&!ba.obj.other_user_fbid))return;var ca=i.CHANGE_MUTE_SETTINGS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,other_user_fbid:ba.obj.other_user_fbid,mute_settings:ba.obj.mute_settings}];this.$MercuryChannelHandler1.handleUpdate({actions:da,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__handleMessagingPayload=function(aa,ba){"use strict";switch(ba.obj.event){case q.DELIVER:this.$MercuryChannelHandler5(aa,ba);break;case q.READ:case q.UNREAD:this.$MercuryChannelHandler7(aa,ba);break;case q.READ_ALL:this.$MercuryChannelHandlera(aa,ba);break;case q.DELETE:this.$MercuryChannelHandler8(aa,ba);break;case q.DELETE_MESSAGES:this.$MercuryChannelHandler9(aa,ba);break;case q.TAG:this.$MercuryChannelHandlerd(aa,ba);break;case q.REPORT_SPAM:this.$MercuryChannelHandlerc(aa,ba);break;case q.READ_RECEIPT:this.$MercuryChannelHandlerg(aa,ba);break;case q.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandlerh(aa,ba);break;}};z.prototype.getRouting=function(){"use strict";return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};z.prototype.__getMessagingPayloadType=function(){"use strict";return h.getArbiterType('messaging');};z.prototype.__getMercuryPayloadType=function(){"use strict";return h.getArbiterType('mercury');};z.prototype.__getInboxPayloadType=function(){"use strict";return h.getArbiterType('inbox');};z.prototype.$MercuryChannelHandler6=function(aa){"use strict";return (aa==this.__getMessagingPayloadType());};z.prototype.$MercuryChannelHandlerf=function(aa){"use strict";return (aa==this.__getMercuryPayloadType());};z.prototype.$MercuryChannelHandlere=function(aa){"use strict";return (aa==this.__getInboxPayloadType());};z.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler4.length){var aa=this.getRouting();for(var ba in aa)this.$MercuryChannelHandler4.push(g.subscribe(h.getArbiterType(ba),aa[ba].bind(this)));}return this;};z.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(g.unsubscribe);this.$MercuryChannelHandler4=[];}return this;};u(z,n);e.exports=z;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","immutable","JSLogger","MercuryActionStatus","mapObject","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o={},p=[],q=k.SUCCESS,r={getSeenBy:function(u,v){if(!u)return [];var w=[],x=o[u.thread_id];if(!x)return w;x.forEach(function(y,z){if(s(u,y,z,v))w.push(z);});return w;},wasSeenByAll:function(u){if(!u)return false;var v=o[u.thread_id];if(!v)return false;return v.every(function(w,x){return s(u,w,x);});},getSeenTimestamps:function(u){var v=o[u];if(!v){v=i.OrderedMap();o[u]=v;}return v;},getSeenTimestamp:function(u,v){var w=o[u];return w?w.get(v):null;}};Object.assign(r,h);function s(u,v,w,x){return !!(v>u.timestamp&&(u.status===(void 0)||u.status===q)&&(!x||w!=u.author));}m.subscribe('update-roger',function(u,v){for(var w in v){var x=o[w]||i.OrderedMap();x=x.withMutations(function(y){for(var z in v[w]){var aa=n.getThreadMetaNow(w);if(aa&&aa.participants)if(aa.participants.indexOf(z)==-1){p.push(t(o));continue;}var ba=y.get(z),ca=v[w][z];if(!ba||ca>ba)y.set(z,ca);}});o[w]=x.sort();}v&&r.inform('change',v);});g.subscribe(j.DUMP_EVENT,function(u,v){v.bad_read_receipts={receipts:p};});function t(u){return l(u,function(v){return v.toJS();});}e.exports=r;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryRoger","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryMessages').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryThreads').get(),p={},q={},r=j['roger.seen_delay'],s={getSeenBy:function(x,y){if(q[x])return [];return k.getSeenBy(t(x),y);},wasSeenByAll:function(x){if(q[x])return false;return k.wasSeenByAll(t(x));}};Object.assign(s,g);function t(x){if(!p[x]){var y=o.getThreadMetaNow(x);if(y)p[x]={thread_id:x,author:y.participants[0],timestamp:y.timestamp};}return p[x];}function u(x){var y=false;m.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=s.getSeenBy(x);if(q[x]){clearTimeout(q[x]);delete q[x];}var da=ba+r,ea=da-Date.now();if(ea>0)q[x]=l(function(){delete q[x];v(x);},ea);p[x]=aa;var fa=s.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;s.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){s.inform('state-changed',y);break;}}k.subscribe('change',function(x,y){for(var z in y)!q[z]&&v(z);});n.subscribe('messages-received',w);n.subscribe('messages-reordered',w);n.subscribe('messages-updated',w);e.exports=s;},null);